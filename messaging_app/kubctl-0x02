#!/bin/bash
# kubctl-0x02 - Blue-Green Deployment Script for Django Messaging App

set -e

echo "🚀 Applying Blue deployment..."
kubectl apply -f messaging_app/blue_deployment.yaml

echo "🚀 Applying Green deployment..."
kubectl apply -f messaging_app/green_deployment.yaml

echo "📦 Checking running pods..."
kubectl get pods -l app=django-messaging-app

echo "⏳ Waiting for Green pods to be ready..."
sleep 15

echo "🧾 Fetching logs for Green deployment to check for errors..."
GREEN_POD=$(kubectl get pods -l version=green -o jsonpath='{.items[0].metadata.name}')
kubectl logs "$GREEN_POD"

echo "✅ If logs look good, switch traffic to Green by updating kubeservice.yaml:"
echo "   Change selector.version from 'blue' to 'green' and reapply:"
echo "   kubectl apply -f messaging_app/kubeservice.yaml"

echo "🎉 Blue-Green deployment applied successfully!"

